# Защита от спама в полях пользователя

## Обзор

Добавлена комплексная защита от спама в полях регистрации и редактирования профиля пользователя.

## Защищенные поля

- **Имя** (`name`)
- **Никнейм** (`nickname`)
- **Био** (`bio`)
- **Название дневника** (`diary_name`)

## Правило валидации `NoSpam`

Файл: `app/Rules/NoSpam.php`

### Что проверяется:

#### 1. **URL и ссылки**
Блокируются:
- `http://`, `https://`, `ftp://`
- `www.`
- Домены: `.com`, `.net`, `.org`, `.ru`, `.info`, `.biz`, `.co`, `.io`, `.me`, `.cc`, `.xyz`, `.top`, `.site`, `.online`, `.club`, `.tk`, `.ml`, `.ga`, `.cf`, `.gq`

#### 2. **Подозрительные паттерны**
Блокируются:
- Деньги: `$100`, `$1,000`
- Финансовые термины: `dollars`, `usd`, `bitcoin`, `btc`, `eth`, `crypto`, `credit`
- Хеш-паттерны: `hs=32символа`
- 3+ звездочки подряд: `***`
- Спам-фразы: `click here`, `confirm transaction`, `claim prize`, `verify account`

#### 3. **Спам-слова**
Блокируются слова:
- Казино: `casino`, `jackpot`, `lottery`
- Медицина: `viagra`, `cialis`, `pharmacy`
- Крипто: `bitcoin`, `crypto`, `forex`
- Финансы: `investment`, `profit`, `earn money`, `make money`, `get rich`
- Призы: `winner`, `prize`, `million dollars`
- Призывы: `click here`, `buy now`, `order now`, `limited offer`, `act now`, `call now`
- Мошенничество: `nigerian prince`, `inheritance`, `paypal`, `western union`

#### 4. **Чрезмерные специальные символы**
Если более 30% содержимого - специальные символы (не буквы, не цифры, не базовая пунктуация), поле блокируется.

## Где применяется

### 1. Регистрация
**Файл:** `app/Http/Controllers/Auth/RegisteredUserController.php`

Проверяются:
- `name` ✅
- `nickname` ✅

### 2. Редактирование профиля
**Файл:** `app/Http/Requests/ProfileUpdateRequest.php`

Проверяются:
- `name` ✅
- `nickname` ✅
- `bio` ✅
- `diary_name` ✅

### 3. Администрирование пользователей
**Файл:** `app/Http/Controllers/AdminController.php`

Метод `updateUser()` проверяет:
- `name` ✅
- `nickname` ✅
- `bio` ✅

## Примеры заблокированного контента

### ❌ Будет заблокировано:

```
* * * $3,222 credit available! Confirm your transaction here: https://yorukholding.com/?0139b1 * * * hs=5d920e230437421a68cc5d0962379d81*
```

**Причины:**
- Содержит URL (`https://`)
- Содержит деньги (`$3,222`)
- Содержит хеш-паттерн (`hs=...`)
- Много звездочек (`***`)
- Спам-фраза (`Confirm your transaction`)
- Спам-слово (`credit`)

```
Buy Bitcoin now! Visit crypto-site.com
```

**Причины:**
- Содержит домен (`crypto-site.com`)
- Спам-слово (`bitcoin`, `crypto`)
- Призыв (`now`)

```
Win $1000000! Click here: www.winner.ru
```

**Причины:**
- Содержит URL (`www.`)
- Содержит домен (`.ru`)
- Деньги (`$1000000`)
- Спам-слова (`win`, `click here`, `winner`)

### ✅ Допустимо:

```
Иван Петров
```

```
Путешественник и любитель снов
```

```
Дневник осознанных сновидений 2025
```

## Сообщения об ошибках

При срабатывании валидации пользователь видит:

- **При наличии URL:** "Поле :attribute не может содержать ссылки."
- **При подозрительных паттернах:** "Поле :attribute содержит недопустимые символы или паттерны."
- **При спам-словах:** "Поле :attribute содержит запрещенные слова."
- **При чрезмерных спецсимволах:** "Поле :attribute содержит слишком много специальных символов."

## Дополнительная защита

Помимо `NoSpam`, также проверяются:

### 1. Запрещенные служебные слова
- `admin`, `moderator`, `root`, `system`, `support` и т.д.

### 2. Ограничения nickname
- Только буквы, цифры, `.`, `-`, `_`
- Regex: `/^[a-zA-Zа-яА-ЯёЁ0-9_.-]+$/u`

### 3. Ограничения diary_name
- Не более 2 эмодзи
- Не может состоять только из заглавных букв
- Должно содержать хотя бы одну букву

## Обход защиты (для легитимных случаев)

Если пользователю действительно нужно указать URL или специальный текст:
1. Обратиться в поддержку
2. Администратор может отредактировать профиль напрямую через админ-панель
3. Или временно отключить правило `NoSpam` для конкретного поля

## Будущие улучшения

- [ ] Добавить машинное обучение для определения спама
- [ ] Логирование попыток спама для анализа
- [ ] Whitelist для легитимных URL (например, социальные сети)
- [ ] Настройки строгости проверки (мягкая/средняя/строгая)
- [ ] API для обновления списка спам-слов

