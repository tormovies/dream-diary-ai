# Пример запроса к DeepSeek API

Эндпоинт: **POST** `https://api.deepseek.com/chat/completions`

Заголовки:
```
Authorization: Bearer <API_KEY>
Content-Type: application/json
```

---

## Тело запроса (request body)

```json
{
  "model": "deepseek-chat",
  "messages": [
    {
      "role": "user",
      "content": "<ПРОМПТ — см. ниже>"
    }
  ],
  "temperature": 0.7,
  "max_tokens": 8000
}
```

В поле `messages[0].content` передаётся одна строка — текст промпта. Ниже пример полного промпта для **одного сна** (без контекста, традиция eclectic).

---

## Пример content (промпт для одиночного сна)

```
Ты — опытный аналитик комплексной (эклектической) традиции традиций, специализирующийся на работе со сновидениями. Ты помогаешь расшифровывать сны, опираясь на глубокий контекст длительной внутренней работы.

ИНСТРУКЦИИ ПО АНАЛИЗУ:
1. Сначала дай ОБЩИЙ ПОСЫЛ сна — одну-две фразы о ключевой теме.
2. Затем сделай ДЕТАЛЬНЫЙ АНАЛИЗ, связывая каждый символ сна с контекстом. Объясняй, как сон продолжает предыдущий контекст.
3. Заверши КРАТКИМИ ПРАКТИЧЕСКИМИ РЕКОМЕНДАЦИЯМИ на основе инсайтов.
4. Тон: поддерживающий, уверенный, видящий прогресс. Анализ должен быть глубоким, но не академичным.
5. <текст инструкций по традиции>

ЯЗЫК ОТВЕТА: RU
ТИП АНАЛИЗА: single
СОН ДЛЯ АНАЛИЗА: Мне снилось, что я летал над городом...

ВАЖНО: После всего анализа предоставь ответ в формате JSON ... (правила про HTML, язык, только json и т.д.) ...
{
  "dream_analysis": {
    "traditions": ["eclectic"],
    "analysis_type": "single",
    "dream_title": "Предложенное название сна на основе его основной темы",
    "dream_detailed": "Детальный анализ сновидения",
    "dream_type": "Тип сна (выбери один: архетипический/бытовой/осознанный/кошмар/пророческий/повторяющийся/исследовательский и т.д.)",
    "key_symbols": [
      {"symbol": "название символа", "meaning": "его значение в контексте истории пользователя"},
      {"symbol": "...", "meaning": "..."}
    ],
    "unified_locations": [
      "стандартизированное название локации (из известных: Дом, Метро, Поле боя, Офис, Школа, Лес и т.д.)",
      "..."
    ],
    "key_tags": [
      "тег1 (например: интеграция, сила, границы, творчество)",
      "тег2",
      "..."
    ],
    "summary_insight": "ОБЩИЙ ПОСЫЛ сна — одну-две фразы о ключевой теме",
    "emotional_tone": "Эмоциональный тон сна (нейтральный, тревожный, радостный, исследовательский и т.д.)"
    "dream_tradition": "..."
  },
  "recommendations": [
    "Рекомендация 1 на основе анализа",
    "Рекомендация 2",
    "..."
  ],
  "seo_metadata": {
    "meta_title": "SEO заголовок для страницы (55-60 символов...)",
    "meta_description": "SEO описание для страницы (150-160 символов...)",
    "h1": "Заголовок H1 для страницы анализа",
    "intro_text": "Вступительный текст под H1 (100-200 слов...)"
  },
  "context_for_next_analysis": {
    "format_version": "1.0",
    "key_themes": ["тема1", "тема2"],
    "recurring_symbols": [
      {"symbol": "символ", "appearances": 2, "interpretations": ["значение1"]}
    ],
    "emotional_pattern": "описание паттерна",
    "unresolved_questions": ["вопрос1", "вопрос2"],
    "recommended_focus": "на что обращать внимание",
    "summary_text": "Краткий текст для следующего запроса"
  }
}
```

---

## Ожидаемая структура ответа (JSON от модели)

Модель должна вернуть один JSON-объект с полями того же уровня (без вложенности в `seo_metadata`):

```json
{
  "dream_analysis": {
    "traditions": ["eclectic"],
    "analysis_type": "single",
    "dream_title": "<h2>Название сна</h2>",
    "dream_detailed": "<p>Текст анализа...</p>",
    "dream_type": "архетипический",
    "key_symbols": [
      {"symbol": "<strong>Символ</strong>", "meaning": "<p>Значение...</p>"}
    ],
    "unified_locations": ["Город", "Небо"],
    "key_tags": ["свобода", "обзор"],
    "summary_insight": "<p>Общий посыл...</p>",
    "emotional_tone": "исследовательский",
    "dream_tradition": "..."
  },
  "recommendations": [
    "Рекомендация 1",
    "Рекомендация 2"
  ],
  "seo_metadata": {
    "meta_title": "Заголовок 55-60 символов",
    "meta_description": "Описание 150-160 символов",
    "h1": "Заголовок H1",
    "intro_text": "Вступительный текст..."
  },
  "context_for_next_analysis": {
    "format_version": "1.0",
    "key_themes": ["полёт", "обзор"],
    "recurring_symbols": [
      {"symbol": "полёт", "appearances": 1, "interpretations": ["стремление к свободе"]}
    ],
    "emotional_pattern": "лёгкость, любопытство",
    "unresolved_questions": [],
    "recommended_focus": "на повторяющиеся образы высоты",
    "summary_text": "Краткий текст для следующего запроса к анализу."
  }
}
```

Поле `context_for_next_analysis.summary_text` сохраняется в `report.current_context` и подставляется в следующий анализ как «контекст предыстории».
